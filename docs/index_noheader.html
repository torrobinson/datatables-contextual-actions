<html>
	<head>
		<!-- Required Libraries -->
		<!-- jQuery -->
		<script src="https://code.jquery.com/jquery-3.4.1.slim.js"></script>

		<!-- DataTables -->
		<link
			rel="stylesheet"
			href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css"
		/>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.20/js/jquery.dataTables.min.js"></script>
		<link
			rel="stylesheet"
			href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.min.css"
		/>
		<script src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>

		<!-- Optional libraries-->
		<!-- Font Awesome -->
		<script
			src="https://kit.fontawesome.com/ce468453a1.js"
			crossorigin="anonymous"
		></script>

		<!-- Boostrap -->
		<link
			rel="stylesheet"
			href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.css"
		/>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.js"></script>

		<!-- Bootbox -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.4.0/bootbox.min.js"></script>

		<!-- The plugin itself -->
		<script src="../dist/dataTables.contextualActions.min.js"></script>
		<link rel="stylesheet" href="../dist/dataTables.contextualActions.min.css"/>

		<!-- Example styling -->
		<style>
			/* Make the buttons stand out on a white background*/
			#my-button-container {
				padding: 20px;
			}

			body {
				font-family: sans-serif !important;
			}

			.text-danger {
				color: red;
			}
			.text-danger:hover {
				background-color: red;
				color: white;
			}
		</style>

		<!-- Get sample data from external file, which will populate the sampleData global variable -->
		<script src="sampleData.js"></script>

		<!-- Initialize the DataTables -->
		<script type="text/javascript">
			$(document).ready(function () {
				// Initialize the table
				var myTable = $('#dt').DataTable({
					// Enable selection and make the first column the selection column
					select: {
						style: 'multi',
						selector: 'td:first-child',
					},
					columns: [
						{
							render: function (data, type, row) {
								return '';
							},
							orderable: false,
							className: 'select-checkbox',
						},
						{
							title: 'Full Name',
							data: 'fullName',
						},
						{
							title: 'Role',
							data: 'role',
						},
						{
							title: 'Location',
							data: 'location',
						},
						{
							title: 'Extension',
							data: 'extension',
						},
						{
							title: 'Start Date',
							data: 'startDate',
						},
						{
							title: 'Salary',
							data: 'salary',
						},
					],
				});

				// Feed it some json data and redraw
				myTable.rows.add(sampleData).draw();

				// Then set up some action options
				var actionOptions = {
					iconPrefix: 'fad fa-fw',
					classes: [],
					contextMenu: {
						enabled: true,
						isMulti: true,
						xoffset: -10,
						yoffset: -10,
						showSpeed: '0.50s',
						headerRenderer: false,
						headerIsFollowedByDivider: true,
						showStaticOptions: false,
						startsNewSelection: false
					},
					// Using bootbox? Customize how you confirm an action
					showConfirmationMethod: bootbox.confirm,
					buttonList: {
						enabled: true,
						iconOnly: false,
						containerSelector: '#my-button-container',
						groupClass: 'btn-group',
						disabledOpacity: 0.4,
						dividerSpacing: 10,
					},
					deselectAfterAction: true,
					items: [
						// Starter seperator won't render after an optionally hidden block of elements
						// This item appears only for employees in Tokyo
						{
							type: 'option',
							multi: false,
							title: 'Only Visible for Tokyo Employees',
							iconClass: 'fa-edit',
							buttonClasses: ['btn', 'btn-outline-secondary'],
							contextMenuClasses: ['text-secondary'],
							action: function (row) {
								bootbox.alert(
									'I only appear for employees in Tokyo!'
								);
							},

							isHidden: function (row) {
								return row.location !== 'Tokyo';
							},
						},
						{
							type: 'divider',
						},

						{
							type: 'static',
							title: 'Static Button',
							iconClass: 'fa-lock',
							buttonClasses: ['btn', 'btn-outline-primary'],
							contextMenuClasses: ['text-primary'],
							action: function () {
								bootbox.alert(
									"I am a static button that doesn't care about what row is selected. I'm always clickable!"
								);
							},
						},

						// Demonstrate not rendering 3 back to back dividers, only 1
						{
							type: 'divider',
						},

						{
							type: 'divider',
						},

						{
							type: 'divider',
						},

						{
							type: 'option',
							multi: false,
							title: 'Edit',
							iconClass: 'fa-edit',
							buttonClasses: ['btn', 'btn-outline-secondary'],
							contextMenuClasses: ['text-secondary'],
							action: function (row) {
								bootbox.alert(
									'Edit here for ' + row[0].fullName
								);
							},
							isDisabled: function (row) {
								return row.fullName.charAt(0) === 'A'; // 'A' name's can't edit, for example
							},
						},

						{
							type: 'option',
							title: 'Transfer',
							multi: false,
							iconClass: 'fa-exchange-alt',
							buttonClasses: ['btn', 'btn-outline-secondary'],
							contextMenuClasses: ['text-secondary'],
							action: function (row) {
								bootbox.alert(
									'Transfer here for ' + row[0].fullName
								);
							},
							isHidden: function (row) {
								return false; // for example
							},
						},

						{
							type: 'divider',
						},

						{
							type: 'option',
							title: 'Unassign Employee',
							multi: true,
							multiTitle: 'Unassign Employees',
							iconClass: 'fa-user-alt-slash',
							buttonClasses: ['btn', 'btn-outline-danger'],
							contextMenuClasses: ['text-danger'],

							isDisabled: (row) => {
								return row.role === '';
							},

							confirmation: function (rows) {
								var message =
									rows.length > 1
										? 'Are you sure you want to unassign ' +
										  rows.length +
										  ' roles?'
										: 'Are you sure you want to unassign ' +
										  rows[0].fullName +
										  "'s role?";
								return {
									title:
										rows.length > 1
											? 'Unassign Employees'
											: 'Unassign Employee',
									message: message,
									buttons: {
										cancel: {
											className: 'btn-link',
											label: 'Cancel',
										},
										confirm: {
											className: 'btn-danger',
											label: '<i class="fa fa-user-slash"></i> Unassign',
										},
									},
								};
							},
							action: function (rows) {
								// For sake of example, change the source data
								window.sampleData
									.filter((data) =>
										rows
											.map((row) => row.fullName)
											.includes(data.fullName)
									)
									.forEach((data) => {
										data.role = '';
										data.location = '';
										data.extension = '';
										data.startDate = '';
										data.salary = '';
									});

								// Then change the data inline without redrawing and losing state
								myTable.rows(function (idx, data, node) {
									if (
										rows
											.map((r) => r.fullName)
											.includes(data.fullName)
									) {
										let rowData = myTable.row(idx).data();
										rowData.role = '';
										rowData.location = '';
										rowData.extension = '';
										rowData.startDate = '';
										rowData.salary = '';
										myTable
											.row(idx)
											.data(rowData)
											.invalidate();
									}
									return false;
								});
							},
						},

						{
							type: 'option',
							title: 'Unassign Employee [Strict Mode]',
							multi: true,
							multiTitle: 'Unassign Employees [Strict Mode]',
							iconClass: 'fa-user-alt-slash',
							buttonClasses: ['btn', 'btn-outline-danger'],
							contextMenuClasses: ['text-danger'],

							isDisabled: (row) => {
								return row.role === '';
							},

							isDisabledStrictMode: true,

							confirmation: function (rows) {
								var message =
									rows.length > 1
										? 'Are you sure you want to unassign ' +
										  rows.length +
										  ' roles?'
										: 'Are you sure you want to unassign ' +
										  rows[0].fullName +
										  "'s role?";
								return {
									title:
										rows.length > 1
											? 'Unassign Employees'
											: 'Unassign Employee',
									message: message,
									buttons: {
										cancel: {
											className: 'btn-link',
											label: 'Cancel',
										},
										confirm: {
											className: 'btn-danger',
											label: '<i class="fa fa-user-slash"></i> Unassign',
										},
									},
								};
							},
							action: function (rows) {
								// For sake of example, change the source data
								window.sampleData
									.filter((data) =>
										rows
											.map((row) => row.fullName)
											.includes(data.fullName)
									)
									.forEach((data) => {
										data.role = '';
										data.location = '';
										data.extension = '';
										data.startDate = '';
										data.salary = '';
									});

								// Then change the data inline without redrawing and losing state
								myTable.rows(function (idx, data, node) {
									if (
										rows
											.map((r) => r.fullName)
											.includes(data.fullName)
									) {
										let rowData = myTable.row(idx).data();
										rowData.role = '';
										rowData.location = '';
										rowData.extension = '';
										rowData.startDate = '';
										rowData.salary = '';
										myTable.row(idx).data(rowData);
									}
									return false;
								});
							},
						},

						{
							type: 'option',
							title: 'Delete Employee',
							multi: true,
							multiTitle: 'Delete Employees',
							iconClass: 'fa-trash',
							buttonClasses: ['btn', 'btn-outline-danger'],
							contextMenuClasses: ['text-danger'],
							confirmation: function (rows) {
								var message =
									rows.length > 1
										? 'Are you sure you want to delete ' +
										  rows.length +
										  ' employees?'
										: 'Are you sure you want to delete ' +
										  rows[0].fullName +
										  '?';
								return {
									title:
										rows.length > 1
											? 'Delete Employees'
											: 'Delete Employee',
									message: message,
									buttons: {
										cancel: {
											className: 'btn-link',
											label: 'Cancel',
										},
										confirm: {
											className: 'btn-danger',
											label: '<i class="fa fa-trash"></i> Delete',
										},
									},
								};
							},
							action: function (rows) {
								// Change source data and redraw
								window.sampleData = window.sampleData.filter(
									(data) =>
										!rows
											.map((row) => row.fullName)
											.includes(data.fullName)
								);
								myTable
									.clear()
									.rows.add(window.sampleData)
									.draw();
							},
						},

						{
							type: 'divider',
						},

						// A normally hidden option that only appears for even rows. Do not render as a button/menu option unless the selected items adhere
						{
							type: 'option',
							multi: false,
							title: 'Only Visible for Accountants',
							iconClass: 'fa-edit',
							buttonClasses: ['btn', 'btn-outline-secondary'],
							contextMenuClasses: ['text-secondary'],
							action: function (row) {
								bootbox.alert(
									'I only appear for even Accountants!'
								);
							},

							isHidden: function (row) {
								return row.role != 'Accountant';
							},
						},

						// Ending seperator to demonstrate that it won't render if a block of elements is hidden after it
						{
							type: 'divider',
						},
						// This item appears only for employees in Tokyo
						{
							type: 'option',
							multi: false,
							title: 'Only Visible for Tokyo Employees',
							iconClass: 'fa-edit',
							buttonClasses: ['btn', 'btn-outline-secondary'],
							contextMenuClasses: ['text-secondary'],
							action: function (row) {
								bootbox.alert(
									'I only appear for employees in Tokyo!'
								);
							},

							isHidden: function (row) {
								return row.location !== 'Tokyo';
							},
						},
					],
				};

				// And initialize our plugin
				myTable.contextualActions(actionOptions);
			});
		</script>
	</head>
	<body>
		<h1>Datatables-contextual-actions example with no header in popup</h1>
		<!-- This is any custom container we want to use to hold our context buttons -->
		<br />
		<div id="my-button-container"></div>
		<br />

		<table id="dt" class="display" style="width: 100%"></table>
	</body>
</html>
